///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

var WebSocket = require('ws'),
    moment = require('moment'),
    sprintf = require('sprintf-js').sprintf;

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

var ws = new WebSocket('ws://localhost:8888');

///////////////////////////////////////////////////////////////////////////////

ws.onmessage = function (ev) {

    var next = moment(),
        diff = next.diff(GLOBAL.last || moment());

    GLOBAL.last = next;

    var p1 = sprintf('%03f', diff),
        p2 = '[' + next.toISOString() + ']',
        p3 = ev.data;

    console.log(p1, p2, p3);
};

///////////////////////////////////////////////////////////////////////////////

ws.onopen = function () {
    var id = setInterval(function () { ws.send('.')}, 0);
    setTimeout(function () { clearInterval(id); }, 10000);
};

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
